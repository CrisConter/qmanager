@{
    ViewBag.Title = "Home";
}

<div class="container">


    <input type="text" id="message" />
    <input type="button" id="sendmessage" value="Send" />

    <ul id="discussion"></ul>

    <select id="listaUser" size="5"></select>


</div>

@section Scripts
{
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.2.0.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!--SignalR script to update the chat page and send messages.-->
    <script type="text/javascript">
        $(function () {
            //Set the hubs URL for the connection
            //  $.connection.hub.url = "http://localhost/appSignalR/signalr";
            // Reference the auto-generated proxy for the hub.

            var chat = $.connection.qManagerHub;

            // Start the connection.
            $.connection.hub.start().done(function () {
                chat.server.enviarIdManager($.connection.hub.id);

                $("#sendmessage").click(function () {
                    chat.server.enviarMensagem($('#listaUser option:selected').val(), $("#message").val());
                });
            });

            chat.client.AdicionarMensagem = function (mensagem) {
                //$("#messageUser").val(mensagem);
                $('#discussion').append('<li>' + htmlEncode(mensagem) + '</li>');
            }

            // Create a function that the hub can call back to display messages.
            chat.client.ReceberPosicao = function (posicao) {
                // Add the message to the page.
                $('#message').val(posicao);
            };

            chat.client.AdicionarLista = function (id, name) {
                $('#listaUser').append($('<option>', {
                    value: id,
                    text: name
                }));
            }

            chat.client.RemoverLista = function (id) {
                $('#listaUser option[value=' + id + ']').remove();
            }
        });

        // This optional function html-encodes messages for display in the page.
        function htmlEncode(value) {
            var encodedValue = $('<div />').text(value).html();
            return encodedValue;
        }
    </script>
}